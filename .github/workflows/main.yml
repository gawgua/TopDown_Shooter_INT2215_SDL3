name: Build

on: [push, pull_request, workflow_dispatch]

env:
    CMAKE_GENERATOR: "'Visual Studio 17 2022'"
    CMAKE_ARCH: "x64"

jobs:
    build-windows:
        runs-on: windows-latest
        steps:
            - uses: actions/checkout@v3
              with:
                submodules: 'recursive'
            - uses: ilammy/msvc-dev-cmd@v1.13.0
              with:
                arch: ${{env.CMAKE_ARCH}}
            - name: CMake generate
              run: |
                cmake -S . -B ${{github.workspace}}/build -DCMAKE_BUILD_TYPE=Release -G ${{env.CMAKE_GENERATOR}} -A ${{env.CMAKE_ARCH}}
            - name: CMake build
              run: |
                cmake --build ${{github.workspace}}/build
            - name: Upload artifact
              uses: actions/upload-artifact@v4
              with:
                name: release
                path: build/src/Release